<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Resumix{% endblock %}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --ink: #102027;
      --muted: #4a626d;
      --line: rgba(16, 32, 39, 0.16);
      --card: rgba(255, 255, 255, 0.82);
      --brand: #0b8b72;
      --brand-deep: #066753;
      --accent: #d65b1f;
      --good: #0f6a2d;
      --bad: #8c1f1f;
      --shadow: 0 18px 34px rgba(16, 32, 39, 0.12);
      --bg-a: #f8efd9;
      --bg-b: #e3f2ea;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Manrope", sans-serif;
      color: var(--ink);
      min-height: 100vh;
      background:
        radial-gradient(circle at 8% 8%, rgba(214, 91, 31, 0.16), transparent 28%),
        radial-gradient(circle at 90% 14%, rgba(11, 139, 114, 0.22), transparent 35%),
        linear-gradient(135deg, var(--bg-a), var(--bg-b));
    }

    .shell {
      max-width: 1180px;
      margin: 0 auto;
      padding: 18px 16px 34px;
      animation: fadeIn 420ms ease-out;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
    }

    .brand {
      font-family: "Space Grotesk", sans-serif;
      font-size: clamp(1.35rem, 3vw, 2rem);
      font-weight: 700;
      letter-spacing: 0.01em;
    }

    .brand span { color: var(--brand); }

    .nav {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .nav a,
    .nav button {
      text-decoration: none;
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 8px 13px;
      font: inherit;
      font-size: 0.84rem;
      font-weight: 700;
      color: #1a2c34;
      background: rgba(255, 255, 255, 0.76);
      cursor: pointer;
      transition: transform 140ms ease, border-color 140ms ease, color 140ms ease;
    }

    .nav a.active {
      border-color: rgba(11, 139, 114, 0.6);
      color: var(--brand-deep);
      background: rgba(11, 139, 114, 0.13);
    }

    .nav a:hover,
    .nav button:hover {
      transform: translateY(-1px);
      border-color: rgba(11, 139, 114, 0.45);
    }

    .nav .logout-btn {
      border-color: rgba(170, 34, 34, 0.45);
      color: #8f1d1d;
      background: rgba(214, 91, 91, 0.14);
    }

    .nav .logout-btn:hover {
      border-color: rgba(170, 34, 34, 0.72);
      color: #ffffff;
      background: #c53636;
    }

    .status {
      margin-bottom: 12px;
      font-size: 0.86rem;
      color: #36505a;
      font-weight: 600;
    }

    .card {
      background: var(--card);
      border: 1px solid rgba(255, 255, 255, 0.9);
      border-radius: 22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(6px);
      padding: clamp(16px, 2.4vw, 26px);
    }

    h1, h2 {
      margin: 0 0 10px;
      font-family: "Space Grotesk", sans-serif;
      line-height: 1.08;
    }

    p {
      margin: 0 0 12px;
      color: var(--muted);
      line-height: 1.58;
    }

    .page-hero {
      margin-bottom: 12px;
      border-radius: 18px;
      border: 1px solid rgba(11, 139, 114, 0.2);
      background: linear-gradient(165deg, rgba(11, 139, 114, 0.13), rgba(255, 255, 255, 0.42));
      padding: 14px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(12, minmax(0, 1fr));
      gap: 12px;
    }

    .span-4 { grid-column: span 4; }
    .span-6 { grid-column: span 6; }
    .span-8 { grid-column: span 8; }
    .span-12 { grid-column: span 12; }

    .field { margin-bottom: 12px; }

    label {
      display: block;
      margin-bottom: 5px;
      font-size: 0.84rem;
      font-weight: 700;
      color: #2f434b;
    }

    input, textarea {
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 13px;
      padding: 11px;
      font: inherit;
      color: var(--ink);
      background: #fff;
      outline: none;
      transition: border-color 140ms ease, box-shadow 140ms ease;
    }

    input:focus,
    textarea:focus {
      border-color: rgba(11, 139, 114, 0.55);
      box-shadow: 0 0 0 3px rgba(11, 139, 114, 0.12);
    }

    textarea { min-height: 120px; resize: vertical; }

    .btn {
      border: none;
      border-radius: 12px;
      padding: 11px 14px;
      font: inherit;
      font-weight: 700;
      color: #fff;
      background: linear-gradient(145deg, var(--brand), var(--brand-deep));
      cursor: pointer;
      transition: transform 140ms ease;
    }

    .btn:hover { transform: translateY(-1px); }

    .btn-accent { background: linear-gradient(145deg, #d65b1f, #b64716); }

    .msg {
      margin-top: 8px;
      min-height: 1.2em;
      font-size: 0.87rem;
      font-weight: 600;
    }

    .ok { color: var(--good); }
    .err { color: var(--bad); }

    .chips {
      display: flex;
      gap: 7px;
      flex-wrap: wrap;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid rgba(11, 139, 114, 0.24);
      background: rgba(11, 139, 114, 0.1);
      color: var(--brand-deep);
      font-size: 0.77rem;
      font-weight: 600;
      padding: 4px 10px;
    }

    .metric {
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 13px;
      background: rgba(255, 255, 255, 0.74);
    }

    .metric .k {
      font-size: 0.75rem;
      color: #5a6f76;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .metric .v {
      margin-top: 4px;
      font-family: "Space Grotesk", sans-serif;
      font-size: 1.2rem;
      font-weight: 700;
    }

    .item {
      border: 1px solid var(--line);
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.74);
      padding: 11px;
      margin-top: 9px;
    }

    .item .head {
      font-weight: 800;
      margin-bottom: 4px;
      font-size: 0.95rem;
    }

    .muted { color: var(--muted); font-size: 0.87rem; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(7px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 980px) {
      .span-4,
      .span-6,
      .span-8 { grid-column: span 12; }
    }

    @media (max-width: 760px) {
      .topbar { flex-direction: column; align-items: flex-start; }
    }
  </style>
  {% block head_extra %}{% endblock %}
</head>
<body>
  <main class="shell">
    <header class="topbar">
      <div class="brand">Resu<span>mix</span></div>
      <nav class="nav">
        <a href="/dashboard/" class="{% if active_page == 'dashboard' %}active{% endif %}">Dashboard</a>
        <a href="/upload/" class="{% if active_page == 'upload' %}active{% endif %}">Upload</a>
        <a href="/analysis/" class="{% if active_page == 'analysis' %}active{% endif %}">Analysis</a>
        <button type="button" id="logoutBtn" class="logout-btn">Logout</button>
      </nav>
    </header>
    <div class="status">Logged in as: <b id="sessionUser">Checking...</b></div>
    {% block content %}{% endblock %}
  </main>
  <script>
    (function () {
      const access = localStorage.getItem("resumix_access");
      const userText = localStorage.getItem("resumix_user");
      if (!access) {
        window.location.replace("/login/");
        return;
      }

      let user = null;
      try {
        user = userText ? JSON.parse(userText) : null;
      } catch (_) {
        user = null;
      }

      const sessionEl = document.getElementById("sessionUser");
      sessionEl.textContent = user && user.email ? user.email : "Authenticated user";

      function getError(data) {
        if (!data) return "Unknown error";
        if (typeof data.detail === "string") return data.detail;
        if (Array.isArray(data.non_field_errors) && data.non_field_errors[0]) return data.non_field_errors[0];
        return JSON.stringify(data);
      }

      async function api(path, options) {
        const opts = options || {};
        const headers = Object.assign({}, opts.headers || {}, { Authorization: `Bearer ${access}` });
        const res = await fetch(path, Object.assign({}, opts, { headers }));
        let data;
        try {
          data = await res.json();
        } catch (_) {
          data = { detail: res.statusText || "Request failed" };
        }
        if (!res.ok) {
          throw new Error(getError(data));
        }
        return data;
      }

      window.ResumixApp = {
        api,
        setMessage(el, msg, ok) {
          el.textContent = msg || "";
          el.className = "msg " + (ok ? "ok" : "err");
        },
      };

      document.getElementById("logoutBtn").addEventListener("click", function () {
        localStorage.removeItem("resumix_access");
        localStorage.removeItem("resumix_refresh");
        localStorage.removeItem("resumix_user");
        localStorage.removeItem("resumix_resume_id");
        window.location.replace("/login/");
      });
    })();
  </script>
  {% block page_js %}{% endblock %}
</body>
</html>
